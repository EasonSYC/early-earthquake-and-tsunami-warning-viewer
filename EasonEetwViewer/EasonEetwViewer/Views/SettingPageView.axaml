<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:EasonEetwViewer.ViewModels"
             xmlns:m="using:EasonEetwViewer.Models"
             xmlns:conv="using:EasonEetwViewer.Converters"
			 xmlns:lang="clr-namespace:EasonEetwViewer.Lang"
             mc:Ignorable="d"
			 d:DesignWidth="800"
			 d:DesignHeight="450"
             x:Class="EasonEetwViewer.Views.SettingPageView"
             x:DataType="vm:SettingPageViewModel">

	<Design.DataContext>
		<vm:SettingPageViewModel/>
	</Design.DataContext>

	<UserControl.Resources>
		<conv:KmoniDataChoiceConverter x:Key="DataChoiceConverter"/>
		<conv:KmoniSensorChoiceConverter x:Key="SensorChoiceConverter"/>
		<conv:AuthenticationStatusConverter x:Key="AuthConverter"/>
		<conv:WebSocketConnectedConverter x:Key="WebSocketButtonConverter"/>
		<conv:OAuthConnectedConverter x:Key="OAuthConverter"/>
		<conv:CultureInfoConverter x:Key="LanguageChoiceConverter"/>
	</UserControl.Resources>

	<ScrollViewer>
		<StackPanel Margin="20">
			<TextBlock Margin="0 20"
					   FontSize="20"
					   FontWeight="Bold"
					   Text="{x:Static lang:Resources.SettingsHeaderText}"/>
		    <StackPanel Margin="0 0"
						Orientation="Horizontal">
				<TextBlock Margin="0 20"
						   FontSize="18"
						   FontWeight="Bold"
						   Text="{x:Static lang:Resources.SettingsDmdssText}"/>
				<TextBlock Margin="10 0"
						   FontSize="15"
						   VerticalAlignment="Center">
					<Run Text="{x:Static lang:Resources.SettingsStatusText}"/>
					<Run Text="{Binding AuthenticationStatus, Converter={StaticResource AuthConverter}, Mode=OneWay}"/>
				</TextBlock>

				<TextBlock Text=""/>
			</StackPanel>
			
			<StackPanel Margin="10 0"
						Orientation="Horizontal">
				<TextBlock Margin="10 0"
						   FontSize="15"
						   VerticalAlignment="Center"
						   Text="{x:Static lang:Resources.SettingsApiText}"/>
				<TextBox Margin="10 0"
						 FontSize="15"
						 Width="410"
						 PasswordChar="*"
						 Watermark="AKe.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
						 Text="{Binding ApiKeyText}"/>
				<Button IsEnabled="{Binding ApiKeyButtonEnabled}"
					    Margin="10 0"
						FontSize="15"
						Command="{Binding ApiKeyButtonCommand}"
						Content="{x:Static lang:Resources.SettingsApiConfirmText}"/>
				<TextBlock Margin="10 0"
						   FontSize="15"
						   VerticalAlignment="Center"
					       Text="{x:Static lang:Resources.SettingsApiConfirmedText}"
						   IsVisible="{Binding ApiKeyConfirmed}"/>
			</StackPanel>

			<StackPanel Margin="10"
						Orientation="Horizontal">
				<Button Margin="0 0"
						FontSize="15"
						Content="{Binding OAuthConnected, Converter={StaticResource OAuthConverter}}"
						Command="{Binding OAuthButtonCommand}"/>
				<TextBlock Margin="10 0"
						   FontSize="15"
						   VerticalAlignment="Center"
						   Text="{x:Static lang:Resources.SettingsOAuthConnectedText}"
						   IsVisible="{Binding OAuthConnected}"/>
			</StackPanel>

			<StackPanel Margin="0"
						Orientation="Horizontal">
				<TextBlock Margin="0 20"
					   FontSize="18"
					   FontWeight="Bold"
					   Text="{x:Static lang:Resources.SettingsWebSocketText}"/>
				<Button Margin="10 0"
						FontSize="15"
						Content="{Binding WebSocketConnected, Converter={StaticResource WebSocketButtonConverter}}"
						Command="{Binding WebSocketButtonCommand}"/>
				<Button Margin="10 0"
						FontSize="15"
						Content="{x:Static lang:Resources.SettingsWebSocketListRefreshText}"
						Command="{Binding WebSocketRefreshCommand}"/>
			</StackPanel>

			<DataGrid Margin="20"
					  GridLinesVisibility="All"
					  CanUserSortColumns="False"
					  BorderThickness="1"
					  BorderBrush="Gray"
					  ItemsSource="{Binding WebSocketConnections}">
				<DataGrid.Columns>
					<DataGridTextColumn Header="{x:Static lang:Resources.SettingsWebSocketConnectionIdText}"
										Binding="{Binding ConnectionId}"/>
					<DataGridTextColumn Header="{x:Static lang:Resources.SettingsWebSocketApplicationNameText}"
										Binding="{Binding AppName}"/>
					<DataGridTextColumn Header="{x:Static lang:Resources.SettingsWebSocketConnectionTimeText}"
										Binding="{Binding StartTime, StringFormat='yyyy/MM/dd HH:mm:ss'}"/>
					<DataGridTemplateColumn Header="{x:Static lang:Resources.SettingsWebSocketDisconnectText}">
						<DataTemplate DataType="{x:Type m:WebSocketConnectionTemplate}">
							<Button HorizontalAlignment="Center"
									IsEnabled="{Binding IsEnabled}"
								    Content="{x:Static lang:Resources.SettingsWebSocketDisconnectText}"
									Command="{Binding DisconnectCommand}"/>
						</DataTemplate>
					</DataGridTemplateColumn>
				</DataGrid.Columns>
			</DataGrid>

			<TextBlock Margin="0 20"
					   FontSize="18"
					   FontWeight="Bold"
					   Text="{x:Static lang:Resources.SettingsKmoniText}"/>

			<StackPanel Margin="10 0"
						Orientation="Horizontal">
				<TextBlock Margin="10 0"
						   FontSize="15"
						   VerticalAlignment="Center"
						   Text="{x:Static lang:Resources.SettingsKmoniStationText}"/>
				<ComboBox ItemsSource="{Binding SensorTypeChoices}"
						  SelectedItem="{Binding KmoniOptions.SensorChoice}">
					<ComboBox.ItemTemplate>
						<DataTemplate>
							<TextBlock Text="{Binding Converter={StaticResource SensorChoiceConverter}}"/>
						</DataTemplate>
					</ComboBox.ItemTemplate>
				</ComboBox>
			</StackPanel>

			<StackPanel Margin="10"
						Orientation="Horizontal">
				<TextBlock Margin="10 0"
						   FontSize="15"
						   VerticalAlignment="Center"
						   Text="{x:Static lang:Resources.SettingsKmoniDataText}"/>
				<ComboBox ItemsSource="{Binding DataTypeChoices}"
						  SelectedItem="{Binding KmoniOptions.DataChoice}">
					<ComboBox.ItemTemplate>
						<DataTemplate>
							<TextBlock Text="{Binding Converter={StaticResource DataChoiceConverter}}"/>
						</DataTemplate>
					</ComboBox.ItemTemplate>
				</ComboBox>
			</StackPanel>

			<TextBlock Margin="0 20"
					   FontSize="18"
					   FontWeight="Bold"
					   Text="{x:Static lang:Resources.SettingsLangText}"/>

			<ComboBox ItemsSource="{Binding LanguageChoices}"
					  SelectedItem="{Binding LanguageChoice}">
				<ComboBox.ItemTemplate>
					<DataTemplate>
						<TextBlock Text="{Binding Converter={StaticResource LanguageChoiceConverter}}"/>
					</DataTemplate>
				</ComboBox.ItemTemplate>
			</ComboBox>
		</StackPanel>
	</ScrollViewer>
</UserControl>
